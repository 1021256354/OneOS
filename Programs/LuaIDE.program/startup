if OneOS then OneOS.ToolBarColour=colours.grey;OneOS.ToolBarTextColour=colours.white end;local a=io;if OneOS then a=OneOS.IO end;local b=fs;if OneOS then b=OneOS.FS end;local c="1.0"local d={...}local e,f=term.getSize()local g=2;local h=20;local i=true;local j=0.4;local k=nil;local l={}local m={}local n={}local o="luaide_distractionEvent"local p="https://raw.github.com/GravityScore/LuaIDE/master/luaide.lua"local q="/"..shell.getRunningProgram()local r="/.LuaIDE-Theme"local function s()return term.isColor and term.isColor()end;local function t(u)local e,f=term.getSize()local v={replaceChar=nil,history=nil,visibleLength=nil,textLength=nil,liveUpdates=nil,exitOnKey=nil}if not u then u={}end;for w,x in pairs(v)do if not u[w]then u[w]=x end end;if u.replaceChar then u.replaceChar=u.replaceChar:sub(1,1)end;if not u.visibleLength then u.visibleLength=e end;local y,z=term.getCursorPos()local line=""local A=0;local B=nil;local function C(D)local E=0;if u.visibleLength and y+A>u.visibleLength+1 then E=y+A-u.visibleLength+1 end;term.setCursorPos(y,z)local F=D or u.replaceChar;if F then term.write(string.rep(F,line:len()-E))else term.write(line:sub(E+1,-1))end;term.setCursorPos(y+A-E,z)end;local function G(H,...)if type(u.liveUpdates)=="function"then local I,J=term.getCursorPos()local F,K=u.liveUpdates(line,H,...)if F==true and K==nil then term.setCursorBlink(false)return line elseif F==true and K~=nil then term.setCursorBlink(false)return K end;term.setCursorPos(I,J)end end;term.setCursorBlink(true)while true do local L,M,N,O,P,Q=os.pullEvent()if L=="char"then local R=false;if u.textLength and line:len()<u.textLength then R=true elseif not u.textLength then R=true end;local S=true;if not u.grantPrint and u.refusePrint then local T={}if type(u.refusePrint)=="table"then for _,x in pairs(u.refusePrint)do table.insert(T,tostring(x):sub(1,1))end elseif type(u.refusePrint)=="string"then for char in u.refusePrint:gmatch(".")do table.insert(T,char)end end;for _,x in pairs(T)do if M==x then S=false end end elseif u.grantPrint then S=false;local T={}if type(u.grantPrint)=="table"then for _,x in pairs(u.grantPrint)do table.insert(T,tostring(x):sub(1,1))end elseif type(u.grantPrint)=="string"then for char in u.grantPrint:gmatch(".")do table.insert(T,char)end end;for _,x in pairs(T)do if M==x then S=true end end end;if R and S then line=line:sub(1,A)..M..line:sub(A+1,-1)A=A+1;C()end elseif L=="key"then if M==keys.enter then break elseif M==keys.left then if A>0 then A=A-1;C()end elseif M==keys.right then if A<line:len()then A=A+1;C()end elseif(M==keys.up or M==keys.down)and u.history then C(" ")if M==keys.up then if B==nil and#u.history>0 then B=#u.history elseif B>1 then B=B-1 end elseif M==keys.down then if B==#u.history then B=nil elseif B~=nil then B=B+1 end end;if u.history and B then line=u.history[B]A=line:len()else line=""A=0 end;C()local F=G("history")if F then return F end elseif M==keys.backspace and A>0 then C(" ")line=line:sub(1,A-1)..line:sub(A+1,-1)A=A-1;C()local F=G("delete")if F then return F end elseif M==keys.home then A=0;C()elseif M==keys.delete and A<line:len()then C(" ")line=line:sub(1,A)..line:sub(A+2,-1)C()local F=G("delete")if F then return F end elseif M==keys["end"]then A=line:len()C()elseif u.exitOnKey then if M==u.exitOnKey or u.exitOnKey=="control"and M==29 or M==157 then term.setCursorBlink(false)return nil end end end;local F=G(L,M,N,O,P,Q)if F then return F end end;term.setCursorBlink(false)if line~=nil then line=line:gsub("^%s*(.-)%s*$","%1")end;return line end;local U={background="gray",backgroundHighlight="lightGray",prompt="cyan",promptHighlight="lightBlue",err="red",errHighlight="pink",editorBackground="gray",editorLineHightlight="lightBlue",editorLineNumbers="gray",editorLineNumbersHighlight="lightGray",editorError="pink",editorErrorHighlight="red",textColor="white",conditional="yellow",constant="orange",["function"]="magenta",string="red",comment="lime"}local V={background="black",backgroundHighlight="black",prompt="black",promptHighlight="black",err="black",errHighlight="black",editorBackground="black",editorLineHightlight="black",editorLineNumbers="black",editorLineNumbersHighlight="white",editorError="black",editorErrorHighlight="black",textColor="white",conditional="white",constant="white",["function"]="white",string="white",comment="white"}local W={{"Water (Default)","https://raw.github.com/GravityScore/LuaIDE/master/themes/default.txt"},{"Fire","https://raw.github.com/GravityScore/LuaIDE/master/themes/fire.txt"},{"Sublime Text 2","https://raw.github.com/GravityScore/LuaIDE/master/themes/st2.txt"},{"Midnight","https://raw.github.com/GravityScore/LuaIDE/master/themes/midnight.txt"},{"TheOriginalBIT","https://raw.github.com/GravityScore/LuaIDE/master/themes/bit.txt"},{"Superaxander","https://raw.github.com/GravityScore/LuaIDE/master/themes/superaxander.txt"},{"Forest","https://raw.github.com/GravityScore/LuaIDE/master/themes/forest.txt"},{"Night","https://raw.github.com/GravityScore/LuaIDE/master/themes/night.txt"},{"Original","https://raw.github.com/GravityScore/LuaIDE/master/themes/original.txt"}}local function X(Y)local Z=io.open(Y)local a0=Z:read("*l")local a1={}while a0~=nil do local w,x=string.match(a0,"^(%a+)=(%a+)")if w and x then a1[w]=x end;a0=Z:read("*l")end;Z:close()return a1 end;if s()then l=U else l=V end;local function a2(a3,a4)if type(a3)=="table"then for _,x in pairs(a3)do a2(x)end else local N,O=term.getCursorPos()local e,f=term.getSize()term.setCursorPos(e/2-a3:len()/2+#a3%2==0 and 1 or 0,a4 or O)print(a3)end end;local function a5(a6)term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.background])term.clear()term.setBackgroundColor(colors[l.backgroundHighlight])for a7=2,4 do term.setCursorPos(1,a7)term.clearLine()end;term.setCursorPos(3,3)term.write(a6)end;local function a8(a9,aa)local function ab(line,L,M,N,O,P,Q)if s()and L=="mouse_click"and N>=e/2-a9/2 and N<=e/2-a9/2+10 and O>=13 and O<=15 then return true,""end end;if not aa then aa=""end;term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.promptHighlight])for a7=8,10 do term.setCursorPos(e/2-a9/2,a7)term.write(string.rep(" ",a9))end;if s()then term.setBackgroundColor(colors[l.errHighlight])for a7=13,15 do term.setCursorPos(e/2-a9/2+1,a7)term.write(string.rep(" ",10))end;term.setCursorPos(e/2-a9/2+2,14)term.write("> Cancel")end;term.setBackgroundColor(colors[l.promptHighlight])term.setCursorPos(e/2-a9/2+1,9)term.write("> "..aa)return t({visibleLength=e/2+a9/2,liveUpdates=ab})end;local function prompt(ac,ad,ae)local function af(ag)for a7,x in ipairs(ac)do if a7==ag then term.setBackgroundColor(x.highlight or colors[l.promptHighlight])else term.setBackgroundColor(x.bg or colors[l.prompt])end;term.setTextColor(x.tc or colors[l.textColor])for a7=-1,1 do term.setCursorPos(x[2],x[3]+a7)term.write(string.rep(" ",x[1]:len()+4))end;term.setCursorPos(x[2],x[3])if a7==ag then term.setBackgroundColor(x.highlight or colors[l.promptHighlight])term.write(" > ")else term.write(" - ")end;term.write(x[1].." ")end end;local ah=ad=="horizontal"and 203 or 200;local ai=ad=="horizontal"and 205 or 208;local ag=1;af(ag)while true do local L,M,N,O=os.pullEvent()if L=="key"and M==28 then return ac[ag][1]elseif L=="key"and M==ah and ag>1 then ag=ag-1;af(ag)elseif L=="key"and M==ai and err==true and ag<#ac-1 or ag<#ac then ag=ag+1;af(ag)elseif ae and L=="key"and M==203 and ag>2 then ag=ag-2;af(ag)elseif ae and L=="key"and M==205 and ag<3 then ag=ag+2;af(ag)elseif L=="mouse_click"then for a7,x in ipairs(ac)do if N>=x[2]-1 and N<=x[2]+x[1]:len()+3 and O>=x[3]-1 and O<=x[3]+1 then return ac[a7][1]end end end end end;local function aj(ac)local function af(ak,ag,al)for a7,x in ipairs(ak)do local bg=colors[l.prompt]local am=colors[l.promptHighlight]if x:find("Back")or x:find("Return")then bg=colors[l.err]am=colors[l.errHighlight]end;if a7==ag then term.setBackgroundColor(am)else term.setBackgroundColor(bg)end;term.setTextColor(colors[l.textColor])for N=-1,1 do term.setCursorPos(3,a7*4+N+4)term.write(string.rep(" ",e-13))end;term.setCursorPos(3,a7*4+4)if a7==ag then term.setBackgroundColor(am)term.write(" > ")else term.write(" - ")end;term.write(x.." ")end end;local function an(ak,al,len)local ao={}for a7=1,len do local ap=ak[a7+al-1]if ap then table.insert(ao,ap)end end;return ao end;local ag=1;local al=1;local len=3;local aq=an(ac,al,len)af(aq,ag,al)while true do local L,ar,N,O=os.pullEvent()if L=="mouse_click"then for a7,x in ipairs(aq)do if N>=3 and N<=e-11 and O>=a7*4+3 and O<=a7*4+5 then return x end end elseif L=="key"and ar==200 then if ag>1 then ag=ag-1;af(aq,ag,al)elseif al>1 then al=al-1;aq=an(ac,al,len)af(aq,ag,al)end elseif L=="key"and ar==208 then if ag<len then ag=ag+1;af(aq,ag,al)elseif al+len-1<#ac then al=al+1;aq=an(ac,al,len)af(aq,ag,al)end elseif L=="mouse_scroll"then os.queueEvent("key",ar==-1 and 200 or 208)elseif L=="key"and ar==28 then return aq[ag]end end end;function monitorKeyboardShortcuts()local as,at=nil,nil;local au=false;local av=false;while true do local H,char=os.pullEvent()if H=="key"and char==42 or char==52 then av=true;at=os.startTimer(j)elseif H=="key"and char==29 or char==157 or char==219 or char==220 then i=false;au=true;as=os.startTimer(j)elseif H=="key"and au then local aw=nil;for w,x in pairs(keys)do if x==char then if av then os.queueEvent("shortcut","ctrl shift",w:lower())else os.queueEvent("shortcut","ctrl",w:lower())end;sleep(0.005)i=true end end;if av then os.queueEvent("shortcut","ctrl shift",char)else os.queueEvent("shortcut","ctrl",char)end elseif H=="timer"and char==as then i=true;au=false elseif H=="timer"and char==at then av=false end end end;local function ax(ay,Y)for a7=1,3 do local az=http.get(ay)if az then local K=az.readAll()az.close()if Y then local Z=io.open(Y,"w")Z:write(K)Z:close()end;return true end end;return false end;local function aA(Y,aB)local ad=Y:sub(1,Y:len()-b.getName(Y):len())if not b.exists(ad)then b.makeDir(ad)end;if not b.isDir(Y)and not b.isReadOnly(Y)then local F=""for _,x in pairs(aB)do F=F..x.."\n"end;local Z=a.open(Y,"w")Z:write(F)Z:close()return true else return false end end;local function aC(Y)if not b.exists(Y)then local ad=Y:sub(1,Y:len()-b.getName(Y):len())if not b.exists(ad)then b.makeDir(ad)end;local Z=a.open(Y,"w")Z:write("")Z:close()end;local a0={}if b.exists(Y)and not b.isDir(Y)then local Z=a.open(Y,"r")if Z then local F=Z:read("*l")while F do table.insert(a0,F)F=Z:read("*l")end;Z:close()end else return nil end;if#a0<1 then table.insert(a0,"")end;return a0 end;m.lua={}m.brainfuck={}m.none={}m.lua.helpTips={"A function you tried to call doesn't exist.","You made a typo.","The index of an array is nil.","The wrong variable type was passed.","A function/variable doesn't exist.","You missed an 'end'.","You missed a 'then'.","You declared a variable incorrectly.","One of your variables is mysteriously nil."}m.lua.defaultHelpTips={2,5}m.lua.errors={["Attempt to call nil."]={1,2},["Attempt to index nil."]={3,2},[".+ expected, got .+"]={4,2,9},["'end' expected"]={6,2},["'then' expected"]={7,2},["'=' expected"]={8,2}}m.lua.keywords={["and"]="conditional",["break"]="conditional",["do"]="conditional",["else"]="conditional",["elseif"]="conditional",["end"]="conditional",["for"]="conditional",["function"]="conditional",["if"]="conditional",["in"]="conditional",["local"]="conditional",["not"]="conditional",["or"]="conditional",["repeat"]="conditional",["return"]="conditional",["then"]="conditional",["until"]="conditional",["while"]="conditional",["true"]="constant",["false"]="constant",["nil"]="constant",["print"]="function",["write"]="function",["sleep"]="function",["pairs"]="function",["ipairs"]="function",["loadstring"]="function",["loadfile"]="function",["dofile"]="function",["rawset"]="function",["rawget"]="function",["setfenv"]="function",["getfenv"]="function"}m.lua.parseError=function(L)local ao={filename="unknown",line=-1,display="Unknown!",err=""}if L and L~=""then ao.err=L;if L:find(":")then ao.filename=L:sub(1,L:find(":")-1):gsub("^%s*(.-)%s*$","%1")L=L:sub(L:find(":")+1).."":gsub("^%s*(.-)%s*$","%1")if L:find(":")then ao.line=L:sub(1,L:find(":")-1)L=L:sub(L:find(":")+2):gsub("^%s*(.-)%s*$","%1")..""end end;ao.display=L:sub(1,1):upper()..L:sub(2,-1).."."end;return ao end;m.lua.getCompilerErrors=function(aD)aD="local function ee65da6af1cb6f63fee9a081246f2fd92b36ef2(...)\n\n"..aD.."\n\nend"local aE,err=loadstring(aD)if not err then local _,L=pcall(aE)if L then err=L end end;if err then local F=err:find("]",1,true)if F then err="string"..err:sub(F+1,-1)end;local ao=m.lua.parseError(err)if tonumber(ao.line)then ao.line=tonumber(ao.line)end;return ao else return m.lua.parseError(nil)end end;m.lua.run=function(Y,aF)local aE,err=OneOS.LoadFile(Y)setfenv(aE,getfenv())if not err then _,err=pcall(function()aE(unpack(aF))end)end;return err end;m.brainfuck.helpTips={"Well idk...","Isn't this the whole point of the language?","Ya know... Not being able to debug it?","You made a typo."}m.brainfuck.defaultHelpTips={1,2,3}m.brainfuck.errors={["No matching '['"]={1,2,3,4}}m.brainfuck.keywords={}m.brainfuck.parseError=function(L)local ao={filename="unknown",line=-1,display="Unknown!",err=""}if L and L~=""then ao.err=L;ao.line=L:sub(1,L:find(":")-1)L=L:sub(L:find(":")+2):gsub("^%s*(.-)%s*$","%1")..""ao.display=L:sub(1,1):upper()..L:sub(2,-1).."."end;return ao end;m.brainfuck.mapLoops=function(aD)local aG={}local al=1;local line=1;for aH in string.gmatch(aD,".")do if aH=="["then aG[al]=true elseif aH=="]"then local aI=false;for a7=al,1,-1 do if aG[a7]==true then aG[a7]=al;aI=true end end;if not aI then return line..": No matching '['"end end;if aH=="\n"then line=line+1 end;al=al+1 end;return aG end;m.brainfuck.getCompilerErrors=function(aD)local F=m.brainfuck.mapLoops(aD)if type(F)=="string"then return m.brainfuck.parseError(F)else return m.brainfuck.parseError(nil)end end;m.brainfuck.run=function(Y)local Z=OneOS.IO.open(Y,"r")local content=Z:read("*a")Z:close()local aJ={}local aK=1;local aL=1;local aG=m.brainfuck.mapLoops(content)if type(aG)=="string"then return aG end;while true do local aH=content:sub(aL,aL)if aH==">"then aK=aK+1;if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end elseif aH=="<"then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;aK=aK-1;if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end elseif aH=="+"then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;aJ[tostring(aK)]=aJ[tostring(aK)]+1 elseif aH=="-"then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;aJ[tostring(aK)]=aJ[tostring(aK)]-1 elseif aH=="."then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;if term.getCursorPos()>=e then print("")end;write(string.char(math.max(1,aJ[tostring(aK)])))elseif aH==","then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;term.setCursorBlink(true)local L,M=os.pullEvent("char")term.setCursorBlink(false)aJ[tostring(aK)]=string.byte(M)if term.getCursorPos()>=e then print("")end;write(M)elseif aH=="/"then if not aJ[tostring(aK)]then aJ[tostring(aK)]=0 end;if term.getCursorPos()>=e then print("")end;write(aJ[tostring(aK)])elseif aH=="["then if aJ[tostring(aK)]==0 then for w,x in pairs(aG)do if w==aL then aL=x end end end elseif aH=="]"then for w,x in pairs(aG)do if x==aL then aL=w-1 end end end;aL=aL+1;if aL>content:len()then print("")break end end end;m.none.helpTips={}m.none.defaultHelpTips={}m.none.errors={}m.none.keywords={}m.none.parseError=function(err)return{filename="",line=-1,display="",err=""}end;m.none.getCompilerErrors=function(aD)return m.none.parseError(nil)end;m.none.run=function(Y)end;n=m.lua;local function aM(L)a5("LuaIDE - Error Help")local aN=nil;for w,x in pairs(n.errors)do if L.display:find(w)then aN=x;break end end;term.setBackgroundColor(colors[l.err])for a7=6,8 do term.setCursorPos(5,a7)term.write(string.rep(" ",35))end;term.setBackgroundColor(colors[l.prompt])for a7=10,18 do term.setCursorPos(5,a7)term.write(string.rep(" ",46))end;if aN then term.setBackgroundColor(colors[l.err])term.setCursorPos(6,7)term.write("Error Help")term.setBackgroundColor(colors[l.prompt])for a7,x in ipairs(aN)do term.setCursorPos(7,a7+10)term.write("- "..n.helpTips[x])end else term.setBackgroundColor(colors[l.err])term.setCursorPos(6,7)term.write("No Error Tips Available!")term.setBackgroundColor(colors[l.prompt])term.setCursorPos(6,11)term.write("There are no error tips available, but")term.setCursorPos(6,12)term.write("you could see if it was any of these:")for a7,x in ipairs(n.defaultHelpTips)do term.setCursorPos(7,a7+12)term.write("- "..n.helpTips[x])end end;prompt({{"Back",e-8,7}},"horizontal")end;local function aO(Y,aB,aP)local aF={}if aP then a5("LuaIDE - Run "..fs.getName(Y))local R=a8(e-13,fs.getName(Y).." ")for aQ in string.gmatch(R,"[^ \t]+")do aF[#aF+1]=aQ:gsub("^%s*(.-)%s*$","%1")end end;aA(Y,aB)term.setCursorBlink(false)term.setBackgroundColor(colors.black)term.setTextColor(colors.white)term.clear()term.setCursorPos(1,1)local err=n.run(Y,aF)term.setBackgroundColor(colors.black)print("\n")if err then if s()then term.setTextColor(colors.red)end;a2("The program has crashed!")end;term.setTextColor(colors.white)a2("Press any key to return to LuaIDE...")while true do local L=os.pullEvent()if L=="key"then break end end;os.queueEvent(o)os.pullEvent()if err then if n==m.lua and err:find("]")then err=fs.getName(Y)..err:sub(err:find("]",1,true)+1,-1)end;while true do a5("LuaIDE - Error!")term.setBackgroundColor(colors[l.err])for a7=6,8 do term.setCursorPos(3,a7)term.write(string.rep(" ",e-5))end;term.setCursorPos(4,7)term.write("The program has crashed!")term.setBackgroundColor(colors[l.prompt])for a7=10,14 do term.setCursorPos(3,a7)term.write(string.rep(" ",e-5))end;local aR=n.parseError(err)term.setCursorPos(4,11)term.write("Line: "..aR.line)term.setCursorPos(4,12)term.write("Error:")term.setCursorPos(5,13)local F=aR.display;local aS=nil;if F:len()>e-8 then for a7=F:len(),1,-1 do if F:sub(a7,a7)==" "then aS=F:sub(a7+1,-1)F=F:sub(1,a7)break end end end;term.write(F)if aS then term.setCursorPos(5,14)term.write(aS)end;local aT=prompt({{"Error Help",e/2-15,17},{"Go To Line",e/2+2,17}},"horizontal")if aT=="Error Help"then aM(aR)elseif aT=="Go To Line"then os.queueEvent(o)os.pullEvent()return"go to",tonumber(aR.line)end end end end;local function aU()term.setBackgroundColor(colors[l.backgroundHighlight])term.setCursorPos(2,1)term.clearLine()term.write("Line: ")local line=t({visibleLength=e-2})local aV=tonumber(line)if aV and aV>0 then return aV else term.setCursorPos(2,1)term.clearLine()term.write("Not a line number!")sleep(1.6)return nil end end;local function aW()local aX={"[Lua]   Brainfuck    None "," Lua   [Brainfuck]   None "," Lua    Brainfuck   [None]"}local ag=1;term.setCursorBlink(false)term.setBackgroundColor(colors[l.backgroundHighlight])term.setCursorPos(2,1)term.clearLine()term.write(aX[ag])while true do local L,M,N,O=os.pullEvent("key")if M==203 then ag=math.max(1,ag-1)term.setCursorPos(2,1)term.clearLine()term.write(aX[ag])elseif M==205 then ag=math.min(#aX,ag+1)term.setCursorPos(2,1)term.clearLine()term.write(aX[ag])elseif M==28 then if ag==1 then n=m.lua elseif ag==2 then n=m.brainfuck elseif ag==3 then n=m.none end;term.setCursorBlink(true)return end end end;local g=2;local aY={}local aZ={}local a_={"if%s+.+%s+then%s*$","for%s+.+%s+do%s*$","while%s+.+%s+do%s*$","repeat%s*$","function%s+[a-zA-Z_0-9]\(.*\)%s*$"}local b0={"end","until%s+.+"}local b1={"else%s*$","elseif%s+.+%s+then%s*$"}local function b2(b3)for _,x in pairs(b3)do local b4=x["lineStart"]local b5=x["lineEnd"]local b6=x["charStart"]local b7=x["charEnd"]if line>=b4 and line<=b5 then if line==b4 then return b6<charNumb elseif line==b5 then return b7>charNumb else return true end end end end;local function b8(line,al)if b2(aY)then return true end;if b2(aZ)then return true end;return false end;local function b9(ba,bb,bc,bd)aY[#aY+1]={}aY[#aY].lineStart=ba;aY[#aY].lineEnd=bb;aY[#aY].charStart=bc;aY[#aY].charEnd=bd end;local function be(ba,bb,bc,bd)aZ[#aZ+1]={}aZ[#aZ].lineStart=ba;aZ[#aZ].lineEnd=bb;aZ[#aZ].charStart=bc;aZ[#aZ].charEnd=bd end;local function bf(bh)local bi=false;local bj=false;for a7=1,#bh do if content[a7]:find("%-%-%[%[")and not bj and not bi then local bk=content[a7]:find("%-%-%[%[")b9(a7,nil,bk,nil)bi=true elseif content[a7]:find("%-%-%[=%[")and not bj and not bi then local bk=content[a7]:find("%-%-%[=%[")b9(a7,nil,bk,nil)bi=true elseif content[a7]:find("%[%[")and not bj and not bi then local bk=content[a7]:find("%[%[")be(a7,nil,bk,nil)bj=true elseif content[a7]:find("%[=%[")and not bj and not bi then local bk=content[a7]:find("%[=%[")be(a7,nil,bk,nil)bj=true end;if content[a7]:find("%]%]")and bj and not bi then local bk,bl=content[a7]:find("%]%]")aZ[#aZ].lineEnd=a7;aZ[#aZ].charEnd=bl;bj=false elseif content[a7]:find("%]=%]")and bj and not bi then local bk,bl=content[a7]:find("%]=%]")aZ[#aZ].lineEnd=a7;aZ[#aZ].charEnd=bl;bj=false end;if content[a7]:find("%]%]")and not bj and bi then local bk,bl=content[a7]:find("%]%]")aY[#aY].lineEnd=a7;aY[#aY].charEnd=bl;bi=false elseif content[a7]:find("%]=%]")and not bj and bi then local bk,bl=content[a7]:find("%]=%]")aY[#aY].lineEnd=a7;aY[#aY].charEnd=bl;bi=false end;if content[a7]:find("%-%-")and not bj and not bi then local bk=content[a7]:find("%-%-")b9(a7,a7,bk,-1)elseif content[a7]:find("'")and not bj and not bi then local bk,bl=content[a7]:find("'")local bm=content[a7]:sub(bl+1,string.len(content[a7]))local _,bl=bm:find("'")be(a7,a7,bk,bl)elseif content[a7]:find('"')and not bj and not bi then local bk,bl=content[a7]:find('"')local bm=content[a7]:sub(bl+1,string.len(content[a7]))local _,bl=bm:find('"')be(a7,a7,bk,bl)end end end;local function bn(bh)local err=nil;if n~=m.lua then err="Cannot indent languages other than Lua!"elseif n.getCompilerErrors(table.concat(bh,"\n")).line~=-1 then err="Cannot indent a program with errors!"end;if err then term.setCursorBlink(false)term.setCursorPos(2,1)term.setBackgroundColor(colors[l.backgroundHighlight])term.clearLine()term.write(err)sleep(1.6)return bh end;local bo={}local bp=0;for w,x in pairs(bh)do local bq=false;local br=false;for _,bs in pairs(a_)do if x:find(bs)and not b8(w,x:find(bs))then bq=true end;if x:find(bs:sub(1,-2))and not b8(w,x:find(bs))then br=true end end;local bt=false;if not bq then for _,bu in pairs(b0)do if x:find(bu)and not b8(w,x:find(bu))and not br then bp=math.max(0,bp-1)bt=true end end end;if not bt then for _,bv in pairs(b1)do if x:find(bv)and not b8(w,x:find(bv))then bq=true;bp=math.max(0,bp-1)end end end;bo[w]=string.rep(" ",bp*g)..x;if bq then bp=bp+1 end end;return bo end;local bw={[1]={"File","New File  ^+N","Open File ^+O","Save File ^+S","Close     ^+W","Print     ^+P","Quit      ^+Q"},[2]={"Edit","Cut Line   ^+X","Copy Line  ^+C","Paste Line ^+V","Delete Line","Clear Line"},[3]={"Functions","Go To Line    ^+G","Re-Indent     ^+I","Set Syntax    ^+E","Start of Line ^+<","End of Line   ^+>"},[4]={"Run","Run Program       ^+R","Run w/ Args ^+Shift+R"}}local bx={["ctrl n"]="New File  ^+N",["ctrl o"]="Open File ^+O",["ctrl s"]="Save File ^+S",["ctrl w"]="Close     ^+W",["ctrl p"]="Print     ^+P",["ctrl q"]="Quit      ^+Q",["ctrl x"]="Cut Line   ^+X",["ctrl c"]="Copy Line  ^+C",["ctrl v"]="Paste Line ^+V",["ctrl g"]="Go To Line    ^+G",["ctrl i"]="Re-Indent     ^+I",["ctrl e"]="Set Syntax    ^+E",["ctrl 203"]="Start of Line ^+<",["ctrl 205"]="End of Line   ^+>",["ctrl r"]="Run Program       ^+R",["ctrl shift r"]="Run w/ Args ^+Shift+R"}local by={["New File  ^+N"]=function(Y,aB)aA(Y,aB)return"new"end,["Open File ^+O"]=function(Y,aB)aA(Y,aB)return"open"end,["Save File ^+S"]=function(Y,aB)aA(Y,aB)end,["Close     ^+W"]=function(Y,aB)aA(Y,aB)return"menu"end,["Print     ^+P"]=function(Y,aB)aA(Y,aB)return nil end,["Quit      ^+Q"]=function(Y,aB)aA(Y,aB)return"exit"end,["Cut Line   ^+X"]=function(Y,aB,O)k=aB[O]table.remove(aB,O)return nil,aB end,["Copy Line  ^+C"]=function(Y,aB,O)k=aB[O]end,["Paste Line ^+V"]=function(Y,aB,O)if k then table.insert(aB,O,k)end;return nil,aB end,["Delete Line"]=function(Y,aB,O)table.remove(aB,O)return nil,aB end,["Clear Line"]=function(Y,aB,O)aB[O]=""return nil,aB,"cursor"end,["Go To Line    ^+G"]=function()return nil,"go to",aU()end,["Re-Indent     ^+I"]=function(Y,aB)local F=bn(aB)aA(Y,aB)return nil,F end,["Set Syntax    ^+E"]=function(Y,aB)aW()if n==m.brainfuck and aB[1]~="-- Syntax: Brainfuck"then table.insert(aB,1,"-- Syntax: Brainfuck")return nil,aB end end,["Start of Line ^+<"]=function()os.queueEvent("key",199)end,["End of Line   ^+>"]=function()os.queueEvent("key",207)end,["Run Program       ^+R"]=function(Y,aB)aA(Y,aB)return nil,aO(Y,aB,false)end,["Run w/ Args ^+Shift+R"]=function(Y,aB)aA(Y,aB)return nil,aO(Y,aB,true)end}local function bz(open)term.setCursorPos(1,1)term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.backgroundHighlight])term.clearLine()local bA=0;for _,x in pairs(bw)do term.setCursorPos(3+bA,1)term.write(x[1])bA=bA+x[1]:len()+3 end;if open then local bB={}local N=1;for _,x in pairs(bw)do if open==x[1]then bB=x;break end;N=N+x[1]:len()+3 end;N=N+1;local ak={}for a7=2,#bB do table.insert(ak,bB[a7])end;local len=1;for _,x in pairs(ak)do if x:len()+2>len then len=x:len()+2 end end;for a7,x in ipairs(ak)do term.setCursorPos(N,a7+1)term.write(string.rep(" ",len))term.setCursorPos(N+1,a7+1)term.write(x)end;term.setCursorPos(N,#ak+2)term.write(string.rep(" ",len))return ak,len end end;local function bC(bD,bE)local bA=0;local open=nil;for _,x in pairs(bw)do if bD>=bA+3 and bD<=bA+x[1]:len()+2 then open=x[1]break end;bA=bA+x[1]:len()+3 end;local bF=bA+2;if not open then return false end;term.setCursorBlink(false)term.setCursorPos(bF,1)term.setBackgroundColor(colors[l.background])term.write(string.rep(" ",open:len()+2))term.setCursorPos(bF+1,1)term.write(open)sleep(0.1)local ak,len=bz(open)local ao=true;local I,J=term.getCursorPos()while type(ao)~="string"do local L,M,N,O=os.pullEvent()if L=="mouse_click"then if N<bF-1 or N>bF+len-1 then break elseif O>#ak+2 then break elseif O==1 then break end;for a7,x in ipairs(ak)do if O==a7+1 and N>=bF and N<=bF+len-2 then term.setCursorPos(bF,O)term.setBackgroundColor(colors[l.background])term.write(string.rep(" ",len))term.setCursorPos(bF+1,O)term.write(x)sleep(0.1)bz(open)ao=x;break end end end end;term.setCursorPos(I,J)term.setCursorBlink(true)return ao end;local bG={"if%s+.+%s+then%s*$","for%s+.+%s+do%s*$","while%s+.+%s+do%s*$","repeat%s*$","function%s+[a-zA-Z_0-9]?\(.*\)%s*$","=%s*function%s*\(.*\)%s*$","else%s*$","elseif%s+.+%s+then%s*$"}local bH={["("]=")",["{"]="}",["["]="]",["\""]="\"",["'"]="'"}local N,O=0,0;local bI,bJ=0,f-1;local bK,bL=0,1;local bM,bN=0,0;local aB={}local bO=n.parseError(nil)local bP=true;local bQ=os.clock()local function bR(line,bS,bT)local match=string.match(line,bS)if match then if type(bT)=="number"then term.setTextColor(bT)elseif type(bT)=="function"then term.setTextColor(bT(match))end;term.write(match)term.setTextColor(colors[l.textColor])return line:sub(match:len()+1,-1)end;return nil end;local function bU(line)if n==m.lua then while line:len()>0 do line=bR(line,"^%-%-%[%[.-%]%]",colors[l.comment])or bR(line,"^%-%-.*",colors[l.comment])or bR(line,"^\".*[^\\]\"",colors[l.string])or bR(line,"^\'.*[^\\]\'",colors[l.string])or bR(line,"^%[%[.-%]%]",colors[l.string])or bR(line,"^[%w_]+",function(match)if n.keywords[match]then return colors[l[n.keywords[match]]]end;return colors[l.textColor]end)or bR(line,"^[^%w_]",colors[l.textColor])end else term.write(line)end end;local function af()term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.editorBackground])term.clear()bz()bK,bL=tostring(#aB):len()+1,1;bI,bJ=e-bK,f-1;for a7=1,bJ do local F=aB[bN+a7]if F then local bV=string.rep(" ",bK-1-tostring(bN+a7):len())..tostring(bN+a7)local a0=F:sub(bM+1,bI+bM+1)bV=bV..":"if bO.line==bN+a7 then bV=string.rep(" ",bK-2).."!:"end;term.setCursorPos(1,a7+bL)term.setBackgroundColor(colors[l.editorBackground])if bN+a7==O then if bN+a7==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineHightlight])end;term.clearLine()elseif bN+a7==bO.line then term.setBackgroundColor(colors[l.editorError])term.clearLine()end;term.setCursorPos(1-bM+bK,a7+bL)if bN+a7==O then if bN+a7==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineHightlight])end elseif bN+a7==bO.line then term.setBackgroundColor(colors[l.editorError])else term.setBackgroundColor(colors[l.editorBackground])end;if bN+a7==bO.line then if bP then term.write(F)else term.write(bO.display)end else bU(F)end;term.setCursorPos(1,a7+bL)if bN+a7==O then if bN+a7==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorError])else term.setBackgroundColor(colors[l.editorLineNumbersHighlight])end elseif bN+a7==bO.line then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineNumbers])end;term.write(bV)end end;term.setCursorPos(N-bM+bK,O-bN+bL)end;local function bW(...)local ba={...}bK=tostring(#aB):len()+1;for _,bX in pairs(ba)do local F=aB[bX]if F then local bV=string.rep(" ",bK-1-tostring(bX):len())..tostring(bX)local a0=F:sub(bM+1,bI+bM+1)bV=bV..":"if bO.line==bX then bV=string.rep(" ",bK-2).."!:"end;term.setCursorPos(1,bX-bN+bL)term.setBackgroundColor(colors[l.editorBackground])if bX==O then if bX==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineHightlight])end elseif bX==bO.line then term.setBackgroundColor(colors[l.editorError])end;term.clearLine()term.setCursorPos(1-bM+bK,bX-bN+bL)if bX==O then if bX==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineHightlight])end elseif bX==bO.line then term.setBackgroundColor(colors[l.editorError])else term.setBackgroundColor(colors[l.editorBackground])end;if bX==bO.line then if bP then term.write(F)else term.write(bO.display)end else bU(F)end;term.setCursorPos(1,bX-bN+bL)if bX==O then if bX==bO.line and os.clock()-bQ>3 then term.setBackgroundColor(colors[l.editorError])else term.setBackgroundColor(colors[l.editorLineNumbersHighlight])end elseif bX==bO.line then term.setBackgroundColor(colors[l.editorErrorHighlight])else term.setBackgroundColor(colors[l.editorLineNumbers])end;term.write(bV)end end;term.setCursorPos(N-bM+bK,O-bN+bL)end;local function bY(N,O,bZ)local y,z=N-bM,O-bN;local C=false;if y<1 then bM=N-1;y=1;C=true elseif y>bI then bM=N-bI;y=bI;C=true end;if z<1 then bN=O-1;z=1;C=true elseif z>bJ then bN=O-bJ;z=bJ;C=true end;if C or bZ then af()end;term.setCursorPos(y+bK,z+bL)end;local function b_(F,Y)if type(F)=="string"and by[F]then local aT,c0,c1=by[F](Y,aB,O)if type(aT)=="string"then term.setCursorBlink(false)return aT end;if type(c0)=="table"then if#aB<1 then table.insert(aB,"")end;O=math.min(O,#aB)N=math.min(N,aB[O]:len()+1)aB=c0 elseif type(c0)=="string"then if c0=="go to"and c1 then N,O=1,math.min(#aB,c1)bY(N,O)end end end;term.setCursorBlink(true)af()term.setCursorPos(N-bM+bK,O-bN+bL)end;local function c2(Y)N,O=1,1;bK,bL=0,1;bM,bN=0,0;aB=aC(Y)if not aB then return"menu"end;if aB[1]=="-- Syntax: Brainfuck"then n=m.brainfuck end;local c3=os.clock()local c4=os.clock()local c5=os.clock()local c6=false;af()term.setCursorPos(N+bK,O+bL)term.setCursorBlink(true)local c7=os.startTimer(3)while true do local L,ar,bD,bE=os.pullEvent()if L=="key"and i then if ar==200 and O>1 then N,O=math.min(N,aB[O-1]:len()+1),O-1;bW(O,O+1)bY(N,O)elseif ar==208 and O<#aB then N,O=math.min(N,aB[O+1]:len()+1),O+1;bW(O,O-1)bY(N,O)elseif ar==203 and N>1 then N=N-1;local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bY(N,O,bZ)elseif ar==205 and N<aB[O]:len()+1 then N=N+1;local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bY(N,O,bZ)elseif(ar==28 or ar==156)and bP and true or O+bN-1==bO.line then local Z=nil;for _,x in pairs(bG)do if aB[O]:find(x)then Z=x end end;local _,c8=aB[O]:find("^[ ]+")if not c8 then c8=0 end;if Z then table.insert(aB,O+1,string.rep(" ",c8+2))if not Z:find("else",1,true)and not Z:find("elseif",1,true)then table.insert(aB,O+2,string.rep(" ",c8)..Z:find("repeat",1,true)and"until "or Z:find("{",1,true)and"}"or"end")end;N,O=c8+3,O+1;bY(N,O,true)else local c9=aB[O]aB[O]=aB[O]:sub(1,N-1)table.insert(aB,O+1,string.rep(" ",c8)..c9:sub(N,-1))N,O=c8+1,O+1;bY(N,O,true)end elseif ar==14 and bP and true or O+bN-1==bO.line then if N>1 then local Z=false;for w,x in pairs(bH)do if aB[O]:sub(N-1,N-1)==w then Z=true end end;aB[O]=aB[O]:sub(1,N-2)..aB[O]:sub(N+Z and 1 or 0,-1)bW(O)N=N-1;bY(N,O)elseif O>1 then local ca=aB[O-1]:len()+1;aB[O-1]=aB[O-1]..aB[O]table.remove(aB,O)N,O=ca,O-1;bY(N,O,true)end elseif ar==199 then N=1;local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bY(N,O,bZ)elseif ar==207 then N=aB[O]:len()+1;local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bY(N,O,bZ)elseif ar==211 and bP and true or O+bN-1==bO.line then if N<aB[O]:len()+1 then aB[O]=aB[O]:sub(1,N-1)..aB[O]:sub(N+1)local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bW(O)bY(N,O,bZ)elseif O<#aB then aB[O]=aB[O]..aB[O+1]table.remove(aB,O+1)af()bY(N,O)end elseif ar==15 and bP and true or O+bN-1==bO.line then aB[O]=string.rep(" ",g)..aB[O]N=N+2;local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bW(O)bY(N,O,bZ)elseif ar==201 then O=math.min(math.max(O-bJ,1),#aB)N=math.min(aB[O]:len()+1,N)bY(N,O,true)elseif ar==209 then O=math.min(math.max(O+bJ,1),#aB)N=math.min(aB[O]:len()+1,N)bY(N,O,true)end elseif L=="char"and i and bP and true or O+bN-1==bO.line then local cb=false;for w,x in pairs(bH)do if ar==x and aB[O]:find(w,1,true)and aB[O]:sub(N,N)==x then cb=true end end;local cc=false;if not cb then for w,x in pairs(bH)do if ar==w and aB[O]:sub(N,N)~=w then ar=ar..x;cc=true end end;aB[O]=aB[O]:sub(1,N-1)..ar..aB[O]:sub(N,-1)end;N=N+cc and 1 or ar:len()local bZ=false;if O-bN+bL<bL+1 then bZ=true end;bW(O)bY(N,O,bZ)elseif L=="mouse_click"and ar==1 then if bE>1 then if bD<=bK and bE-bL==bO.line-bN then bP=not bP;bW(bO.line)else local cd=O;O=math.min(math.max(bN+bE-bL,1),#aB)N=math.min(math.max(bM+bD-bK,1),aB[O]:len()+1)if cd~=O then bW(cd,O)end;bY(N,O)end else local F=bC(bD,bE)if F then local aT=b_(F,Y)if aT then return aT end end end elseif L=="shortcut"then local F=bx[ar.." "..bD]if F then local ce=nil;local cf=0;for a7,cg in ipairs(bw)do for _,ch in pairs(cg)do if ch==F then ce=bw[a7][1]break end end;if ce then break end;cf=cf+cg[1]:len()+3 end;local bF=cf+2;term.setCursorBlink(false)term.setCursorPos(bF,1)term.setBackgroundColor(colors[l.background])term.write(string.rep(" ",ce:len()+2))term.setCursorPos(bF+1,1)term.write(ce)sleep(0.1)bz()local aT=b_(F,Y)if aT then return aT end end elseif L=="mouse_scroll"then if ar==-1 and bN>0 then bN=bN-1;if os.clock()-c4>0.0005 then af()term.setCursorPos(N-bM+bK,O-bN+bL)end;c4=os.clock()c6=true elseif ar==1 and bN<#aB-bJ then bN=bN+1;if os.clock()-c4>0.0005 then af()term.setCursorPos(N-bM+bK,O-bN+bL)end;c4=os.clock()c6=true end elseif L=="timer"and ar==c7 then bW(O)c7=os.startTimer(3)end;if c6 and os.clock()-c4>0.1 then af()term.setCursorPos(N-bM+bK,O-bN+bL)c6=false end;if os.clock()-c3>h then aA(Y,aB)c3=os.clock()end;if os.clock()-c5>1 then local ci=bO;bO=n.parseError(nil)local aD=""for _,x in pairs(aB)do aD=aD..x.."\n"end;bO=n.getCompilerErrors(aD)bO.line=math.min(bO.line-2,#aB)if bO~=ci then af()end;c5=os.clock()end end;return"menu"end;local function cj()local a9=e-13;a5("Lua IDE - New File")local aw=a8(a9,"/")if not aw or aw==""then return"menu"end;aw="/"..aw;a5("Lua IDE - New File")term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.promptHighlight])for a7=8,10 do term.setCursorPos(e/2-a9/2,a7)term.write(string.rep(" ",a9))end;term.setCursorPos(1,9)if b.isDir(aw)then a2("Cannot Edit a Directory!")sleep(1.6)return"menu"elseif b.exists(aw)then a2("File Already Exists!")local aT=prompt({{"Open",e/2-9,14},{"Cancel",e/2+2,14}},"horizontal")if aT=="Open"then return"edit",aw elseif aT=="Cancel"then return"menu"end else return"edit",aw end end;local function ck()local a9=e-13;a5("Lua IDE - Open File")local aw=a8(a9,"/")if not aw or aw==""then return"menu"end;aw="/"..aw;a5("Lua IDE - New File")term.setTextColor(colors[l.textColor])term.setBackgroundColor(colors[l.promptHighlight])for a7=8,10 do term.setCursorPos(e/2-a9/2,a7)term.write(string.rep(" ",a9))end;term.setCursorPos(1,9)if b.isDir(aw)then a2("Cannot Open a Directory!")sleep(1.6)return"menu"elseif not b.exists(aw)then a2("File Doesn't Exist!")local aT=prompt({{"Create",e/2-11,14},{"Cancel",e/2+2,14}},"horizontal")if aT=="Create"then return"edit",aw elseif aT=="Cancel"then return"menu"end else return"edit",aw end end;local function cl()local function af(cm)a5("LuaIDE - Update")term.setBackgroundColor(colors[l.prompt])term.setTextColor(colors[l.textColor])for a7=8,10 do term.setCursorPos(e/2-cm:len()+4,a7)write(string.rep(" ",cm:len()+4))end;term.setCursorPos(e/2-cm:len()+4,9)term.write(" - "..cm.." ")term.setBackgroundColor(colors[l.errHighlight])for a7=8,10 do term.setCursorPos(e/2+2,a7)term.write(string.rep(" ",10))end;term.setCursorPos(e/2+2,9)term.write(" > Cancel ")end;if not http then af("HTTP API Disabled!")sleep(1.6)return"settings"end;af("Updating...")local cn=os.startTimer(10)http.request(p)while true do local L,M,N,O=os.pullEvent()if L=="key"and M==28 or L=="mouse_click"and N>=e/2+2 and N<=e/2+12 and O==9 then af("Cancelled")sleep(1.6)break elseif L=="http_success"and M==p then local bo=N.readAll()local co=io.open(q,"r")local cp=co:read("*a")co:close()if cp~=bo then af("Update Found")sleep(1.6)local Z=io.open(q,"w")Z:write(bo)Z:close()af("Click to Exit")while true do local L=os.pullEvent()if L=="mouse_click"or not s()and L=="key"then break end end;return"exit"else af("No Updates Found!")sleep(1.6)break end elseif L=="http_failure"or L=="timer"and M==cn then af("Update Failed!")sleep(1.6)break end end;return"settings"end;local function cq()a5("LuaIDE - Theme")if s()then local cr={"Back"}for _,x in pairs(W)do table.insert(cr,x[1])end;local a6=aj(cr)local ay=nil;for _,x in pairs(W)do if x[1]==a6 then ay=x[2]end end;if not ay then return"settings"end;if a6=="Dawn (Default)"then term.setBackgroundColor(colors[l.backgroundHighlight])term.setCursorPos(3,3)term.clearLine()term.write("LuaIDE - Loaded Theme!")sleep(1.6)fs.delete(r)l=U;return"menu"end;term.setBackgroundColor(colors[l.backgroundHighlight])term.setCursorPos(3,3)term.clearLine()term.write("LuaIDE - Downloading...")fs.delete("/.LuaIDE_temp_theme_file")ax(ay,"/.LuaIDE_temp_theme_file")local F=X("/.LuaIDE_temp_theme_file")term.setCursorPos(3,3)term.clearLine()if F then term.write("LuaIDE - Loaded Theme!")fs.delete(r)fs.move("/.LuaIDE_temp_theme_file",r)l=F;sleep(1.6)return"menu"end;term.write("LuaIDE - Could Not Load Theme!")fs.delete("/.LuaIDE_temp_theme_file")sleep(1.6)return"settings"else term.setCursorPos(1,8)a2("Themes are not available on")a2("normal computers!")end end;local function cs()a5("LuaIDE - Settings")local aT=prompt({{"Change Theme",e/2-17,8},{"Return to Menu",e/2-22,13},{"Exit IDE",e/2+2,13,bg=colors[l.err],highlight=colors[l.errHighlight]}},"vertical",true)if aT=="Change Theme"then return cq()elseif aT=="Return to Menu"then return"menu"elseif aT=="Exit IDE"then return"exit"end end;local function bw()a5("Welcome to LuaIDE "..c)local aT=prompt({{"New File",e/2-13,8},{"Open File",e/2-14,13},{"Settings",e/2+2,8},{"Exit IDE",e/2+2,13,bg=colors[l.err],highlight=colors[l.errHighlight]}},"vertical",true)if aT=="New File"then return"new"elseif aT=="Open File"then return"open"elseif aT=="Settings"then return"settings"elseif aT=="Exit IDE"then return"exit"end end;local function ct(cu)local aT,K="menu",nil;if type(cu)=="table"and#cu>0 then local Z="/"..shell.resolve(cu[1])if b.isDir(Z)then print("Cannot edit a directory.")end;aT,K="edit",Z end;while true do if aT=="menu"then aT=bw()end;if aT=="new"then aT,K=cj()elseif aT=="open"then aT,K=ck()elseif aT=="settings"then aT=cs()end;if aT=="exit"then break end;if aT=="edit"and K then aT=c2(K)end end end;if fs.exists(r)then l=X(r)end;if not l and s()then l=U elseif not l then l=V end;local _,err=pcall(function()parallel.waitForAny(function()ct(d)end,monitorKeyboardShortcuts)end)if err and not err:find("Terminated")then term.setCursorBlink(false)a5("LuaIDE - Crash! D:")term.setBackgroundColor(colors[l.err])for a7=6,8 do term.setCursorPos(5,a7)term.write(string.rep(" ",36))end;term.setCursorPos(6,7)term.write("LuaIDE Has Crashed! D:")term.setBackgroundColor(colors[l.background])term.setCursorPos(2,10)print(err)term.setBackgroundColor(colors[l.prompt])local _,bE=term.getCursorPos()for a7=bE+1,bE+4 do term.setCursorPos(5,a7)term.write(string.rep(" ",36))end;term.setCursorPos(6,bE+2)term.write("Please report this error to")term.setCursorPos(6,bE+3)term.write("GravityScore! ")term.setBackgroundColor(colors[l.background])if s()then a2("Click to Exit...",f-1)else a2("Press Any Key to Exit...",f-1)end;while true do local L=os.pullEvent()if L=="mouse_click"or not s()and L=="key"then break end end;os.queueEvent(o)os.pullEvent()end;term.setBackgroundColor(colors.black)term.setTextColor(colors.white)term.clear()term.setCursorPos(1,1)a2("Thank You for Using Lua IDE "..c)a2("Made by GravityScore")